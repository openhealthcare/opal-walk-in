{% load forms %}
<div class="modal-header">
  <button type="button" class="close" ng-click="cancel()">Ã—</button>
  <h3>
    <i class="glyphicon glyphicon-ok"></i>
    Walk-in Next Stage
  </h3>
</div>
<div class="modal-body">

  <!-- Initial State Walkin triage -->
  <div ng-show="episode.tagging[0].walkin_triage == true && meta.accepted == null">
    <p>Accept onto walk-in service?</p>
    <center>
      <button class="btn btn-primary btn-lg" ng-click="meta.accepted = true">Doctor-led care</button>
      <button class="btn btn-primary btn-lg"  ng-click="meta.accepted = false">Nurse-led care</button>
    </center>
  </div>

  <!-- Triage -> Doctor led care -->
  <div ng-show="episode.tagging[0].walkin_triage == true && meta.accepted == true">
    <p>Are you sure?</p>
    <center>
      <button class="btn btn-primary btn-lg"  ng-click="move_to_doctor()">Move to doctor</button>
    </center>
  </div>

  <!-- Triage -> Nurse Led care  -->
  <div ng-show="episode.tagging[0].walkin_triage == true && meta.accepted == false">
    <form class="form-horizontal">
      {% select label="Reason" model="meta.nurse_reason" lookuplist="wi_nurse_reason_list" %}
      {% input label="Diagnosis" model="meta.diagnosis" lookuplist="condition_list" show="meta.nurse_reason=='Treated by nurse'" %}
      {% textarea label="Treatment" model="meta.treatment" show="meta.nurse_reason=='Treated by nurse'" %}
    </form>
    <center>
      <button class="btn btn-primary btn-lg"  ng-click="nurse_led_care()">Remove from list</button>
    </center>
  </div>

  <!-- Initial state Doctor led care -->
  <div ng-show="episode.tagging[0].walkin_doctor == true && meta.next == null">
    <p>Walk-in appointment completed. Outstanding result?</p>
    <center>
      <button class="btn btn-primary btn-lg" ng-click="meta.next = 'outstanding'">Outstanding result</button>
      <button class="btn btn-primary btn-lg"  ng-click="meta.next = 'no_outstanding'">No outstanding result</button>
      <button class="btn btn-primary btn-lg"  ng-click="meta.next = 'admit'">Admit to ward</button>
    </center>
  </div>

  <div ng-show="episode.tagging[0].walkin_doctor == true && meta.next == 'outstanding'">
    <p>Are you sure?</p>
    <center>
      <button class="btn btn-primary btn-lg"  ng-click="move_to_review()">Move to review</button>
    </center>
  </div>
  <div ng-show="episode.tagging[0].walkin_doctor == true && meta.next == 'no_outstanding'">
    <p>Are you sure?</p>
    <center>
      <button class="btn btn-primary btn-lg"  ng-click="remove_from_list()">Remove from list</button>
    </center>
  </div>
  <div ng-show="episode.tagging[0].walkin_doctor == true && meta.next == 'admit'">
    <p>Admit to which team?</p>

    {% if teams %}
    <div class="control-group">
      <label>Teams</label>
      <div >
  {% for team in teams %}{% if not team.parent %}{% if team.direct_add %}
          {% if team.has_subtags %}
            <h4>{{team.title}}:</h4>
              {% for subteam in team.team_set.all %}
          <label class="checkbox">
            <input type="checkbox" ng-model="editing.tagging[0].{{subteam.name}}">
            {{subteam.title}}
          </label>
              {% endfor %}
          {% else %}
            <h4>{{team.title}}:</h4>
      <label class="checkbox">
        <input type="checkbox" ng-model="editing.tagging[0].{{team.name}}">
        {{team.title}}
      </label>
          {% endif %}
        {% endif %}{% endif %}{% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <div ng-show="episode.tagging[0].walkin_review == true">
    <p>To be completed</p>
    <center>
      <button class="btn btn-primary btn-lg" ng-click="remove_from_list()">Has Consultant Outpatient Appointment</button>
      <button class="btn btn-primary btn-lg"  ng-click="remove_from_list()">All results back</button>
    </center>
  </div>
</div>
<div class="modal-footer">
  <span ng-show="episode.tagging[0].walkin_doctor == true && meta.next == 'admit'">
    <button class="btn btn-primary" ng-click="admit_to_ward()">Admit to ward</button>
  </span>
  <button class="btn" ng-click="cancel()">Cancel</button>
</div>
